{% extends 'base.html' %}
{% load static %}
{% block title %}Convites de Colaboração{% endblock %}

{% block content %}

<div class="page-wrapper">
  <h1 class="page-title">
    <a class="icon-brand">Convites de Colaboração</a>
  </h1>

  <!-- CONVITES RECEBIDOS -->
  <div class="section-container">
    <h2 class="section-title">Convites Recebidos:</h2>

    <div class="materiais-grid">
    {% for convite in recebidos %}
    <div class="material-card">
      <div class="card-content">
        <h3>{{ convite.material.titulo }}</h3>
        <p><strong>Descrição:</strong> {{ convite.material.descricao }}</p>
        <p><strong>De:</strong> {{ convite.remetente.username }}</p>
        <p><strong>Enviado em:</strong> {{ convite.data_envio|date:"d/m/Y H:i" }}</p>
        {% if convite.status == 'pendente' %}
          <p>Status: <span class="status-pendente">Pendente</span></p>
        {% elif convite.status == 'aceito' %}
          <p class="status-aceito">
            {% if convite.material.status == 'publicado' %}
              Convite aceito e material publicado.
            {% else %}
              Convite aceito. Aguardando publicação pelo remetente.
            {% endif %}
          </p>
        {% elif convite.status == 'negado' %}
          <p class="status-negado">Você recusou este convite.</p>
        {% endif %}
      </div>

      <div class="card-actions">
        <a href="{% url 'visualizar_material' convite.material.id %}" class="btn abrir">Visualizar Material</a>
        {% if convite.status == 'pendente' %}
        <form method="POST" action="{% url 'responder_convite' convite.id %}">
          {% csrf_token %}
          <button name="resposta" value="aceito" class="btn aceitar">Aceitar</button>
          <button name="resposta" value="negado" class="btn negar">Negar</button>
        </form>
        {% endif %}
      </div>
    </div>
    {% empty %}
      <p>Você não tem convites recebidos.</p>
    {% endfor %}
  </div>

  </div>

  <div class="section-container">
    <!-- CONVITES ENVIADOS -->
    <h2 class="section-title">Convites Enviados:</h2>
    
    <div class="materiais-grid">
      {% for convite in enviados %}
      <div class="material-card">
        <div class="card-content">
          <h3>Título: {{ convite.material.titulo }}</h3>
          <p>Descrição: {{ convite.material.descricao }}</p>
          <p>Para: {{ convite.destinatario.username }}</p>
          <p>Enviado em: {{ convite.data_envio|date:"d/m/Y H:i" }}</p>
          <p>Status: {{ convite.get_status_display }}</p>
          {% if convite.status == 'negado' %}
            <p>O colaborador {{ convite.destinatario.username }} recusou o convite.</p>
          {% elif convite.status == 'aceito' %}
          {% if convite.material.status == 'publicado' %}
              <p class="status-aceito">Convite aceito e material publicado.</p>
          {% else %}
              <p>Convite aceito. Você pode publicar o material:</p>
              <form method="POST" action="{% url 'publicar_material' convite.material.id %}">
                  {% csrf_token %}
                  <button type="submit" class="btn-c btn-visualizar">Publicar Material</button>
              </form>
          {% endif %}
          {% else %}
            <p>Convite ainda pendente.</p>
          {% endif %}
        </div>
      </div>
      {% empty %}
          <p>Você não enviou nenhum convite.</p>
      {% endfor %}
    </div>
  </div>
</div>

{% endblock %}
